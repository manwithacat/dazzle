"""
Styles generator for Next.js Onebox.

Generates:
- src/app/globals.css (Tailwind base + custom styles)
"""

from pathlib import Path

from ....core import ir
from ...base.generator import Generator, GeneratorResult


class StylesGenerator(Generator):
    """Generates global CSS and style files."""

    def generate(self) -> GeneratorResult:
        """Generate style files."""
        result = GeneratorResult()

        self._generate_globals_css(result)

        return result

    def _generate_globals_css(self, result: GeneratorResult) -> None:
        """Generate globals.css with Tailwind and custom styles."""
        content = '''/* Global Styles */
/* Generated by DAZZLE Next.js Onebox Stack */

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Custom CSS Variables */
:root {
  --background: 255 255 255;
  --foreground: 15 23 42;
  --card: 255 255 255;
  --card-foreground: 15 23 42;
  --primary: 37 99 235;
  --primary-foreground: 255 255 255;
  --secondary: 241 245 249;
  --secondary-foreground: 15 23 42;
  --muted: 241 245 249;
  --muted-foreground: 100 116 139;
  --accent: 241 245 249;
  --accent-foreground: 15 23 42;
  --destructive: 239 68 68;
  --destructive-foreground: 255 255 255;
  --border: 226 232 240;
  --input: 226 232 240;
  --ring: 37 99 235;
  --radius: 0.5rem;
}

/* Base styles */
@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
  }

  /* Typography */
  h1 {
    @apply text-3xl font-bold tracking-tight;
  }

  h2 {
    @apply text-2xl font-semibold tracking-tight;
  }

  h3 {
    @apply text-xl font-semibold tracking-tight;
  }

  h4 {
    @apply text-lg font-semibold tracking-tight;
  }

  p {
    @apply leading-7;
  }
}

/* Component styles */
@layer components {
  /* Page container */
  .page-container {
    @apply mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8;
  }

  /* Page header */
  .page-header {
    @apply mb-8 flex items-center justify-between;
  }

  /* Card variants */
  .card-hover {
    @apply transition-shadow hover:shadow-md;
  }

  /* Form styles */
  .form-grid {
    @apply grid gap-6 md:grid-cols-2;
  }

  /* Table styles */
  .table-container {
    @apply overflow-hidden rounded-lg border border-gray-200 bg-white;
  }

  /* Attention signal containers */
  .attention-critical {
    @apply border-l-4 border-red-500 bg-red-50 p-4;
  }

  .attention-warning {
    @apply border-l-4 border-amber-500 bg-amber-50 p-4;
  }

  .attention-notice {
    @apply border-l-4 border-blue-500 bg-blue-50 p-4;
  }

  .attention-info {
    @apply border-l-4 border-slate-300 bg-slate-50 p-4;
  }

  /* Status badges */
  .status-badge {
    @apply inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium;
  }

  /* Navigation */
  .nav-link {
    @apply flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 hover:text-gray-900;
  }

  .nav-link-active {
    @apply bg-gray-100 text-gray-900;
  }

  /* Sidebar */
  .sidebar {
    @apply fixed inset-y-0 left-0 z-50 w-64 transform bg-white shadow-lg transition-transform lg:relative lg:translate-x-0;
  }

  /* Action buttons */
  .action-bar {
    @apply flex items-center gap-2;
  }
}

/* Utility classes */
@layer utilities {
  /* Text utilities */
  .text-balance {
    text-wrap: balance;
  }

  /* Animation utilities */
  .animate-fade-in {
    animation: fade-in 0.3s ease-out;
  }

  .animate-slide-up {
    animation: slide-up 0.3s ease-out;
  }

  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes slide-up {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Focus utilities */
  .focus-ring {
    @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2;
  }

  /* Scrollbar utilities */
  .scrollbar-thin {
    scrollbar-width: thin;
  }

  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
}

/* Mantine DataTable overrides */
.mantine-datatable {
  --mantine-color-body: rgb(var(--background));
}
'''
        path = self.output_dir / "src" / "app" / "globals.css"
        self._write_file(path, content)
        result.add_file(path)
