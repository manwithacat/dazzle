# Logic Concepts
# Auto-generated from semantics.py

[meta]
file = "logic"
concept_count = 4

[concepts.access_rules]
category = "Business Logic (v0.7)"
definition = "Inline access control rules on entities defining read/write permissions. Maps to visibility and permission rules at runtime."
syntax = '''
access:
  read: <condition>
  write: <condition>

# Expressions:
# field = current_user - Field matches logged-in user
# role(<name>) - User has the specified role
# field = value - Field equals literal value
# Combine with: and, or
'''
example = '''
entity Document "Document":
  owner: ref User required
  is_public: bool = false

  access:
    read: owner = current_user or is_public = true or role(admin)
    write: owner = current_user or role(admin)
'''
related = ["entity", "persona", "invariant"]
v0_7_changes = "Enhanced in v0.7 with refined syntax"
best_practices = ["Use = for equality (not ==)", "Start with restrictive rules, expand as needed", "Use role() for administrative access", "Combine with persona scopes for UI filtering"]

[concepts.computed_field]
category = "Business Logic (v0.7)"
definition = "Derived values calculated from other fields. Computed at query time, not stored. Part of the declarative business logic layer."
syntax = '''
<field_name>: computed <expression>

# Functions:
# days_since(datetime_field) - Days since the field's value
# sum(related.field) - Sum of related records
# count(related) - Count of related records
'''
example = '''
entity Ticket "Ticket":
  created_at: datetime auto_add
  due_date: date

  # Days since ticket was opened
  days_open: computed days_since(created_at)

  # Days until due (negative if overdue)
  days_until_due: computed days_since(due_date)
'''
related = ["entity", "field_types"]
v0_7_changes = "NEW in v0.7"

[concepts.invariant]
category = "Business Logic (v0.7)"
definition = "Cross-field validation rules that must always hold. Enforced on create and update. Part of the declarative business logic layer."
syntax = '''
invariant: <condition>

# Operators:
# Comparison: =, !=, >, <, >=, <=
# Logical: and, or, not
# Null check: field != null, field = null

# IMPORTANT: Use single = for equality (not ==)
'''
example = '''
entity Booking "Booking":
  start_date: datetime required
  end_date: datetime required
  priority: enum[low,medium,high]=medium
  due_date: date

  # End must be after start
  invariant: end_date > start_date

  # High priority bookings must have a due date
  invariant: priority != high or due_date != null
'''
related = ["entity", "state_machine", "access_rules"]
v0_7_changes = "NEW in v0.7"
best_practices = ["Use = for equality (consistent with access rules)", "Express as 'A or B' for 'if A then B' rules", "Keep invariants simple and focused", "Document the business rule in a comment"]

[concepts.state_machine]
category = "Business Logic (v0.7)"
definition = "Define allowed status/state transitions with optional guards. Prevents invalid state changes and documents workflow rules declaratively."
syntax = '''
transitions:
  <from_state> -> <to_state>
  <from_state> -> <to_state>: requires <field_name>
  <from_state> -> <to_state>: role(<role_name>)
  * -> <to_state>: role(admin)  # wildcard: from any state
'''
example = '''
entity Task "Task":
  status: enum[todo,in_progress,done]=todo
  assigned_to: ref User

  transitions:
    todo -> in_progress: requires assigned_to
    in_progress -> done
    in_progress -> todo
    done -> todo: role(admin)  # Only admin can reopen
'''
related = ["entity", "invariant", "access_rules"]
v0_7_changes = "NEW in v0.7"
best_practices = ["Use for status fields with defined workflows", "Document transition rules that match business processes", "Use role guards for administrative overrides", "Use requires guards for data integrity"]
