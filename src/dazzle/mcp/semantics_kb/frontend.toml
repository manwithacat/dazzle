# Frontend Concepts - HTMX Template System
# Light references for LLM cognition support

[meta]
file = "frontend"
concept_count = 6

[concepts.htmx]
category = "Frontend"
definition = "Declarative HTTP interaction layer for Dazzle-generated frontends. All interactions expressed via HTML attributes (hx-get, hx-post, hx-target, hx-swap, hx-trigger). Server renders HTML fragments; HTMX swaps them into the DOM."
syntax = '''
<element
  hx-{verb}="/endpoint"   <!-- get, post, put, delete -->
  hx-target="#target-id"
  hx-swap="innerHTML"     <!-- innerHTML, outerHTML, beforeend, etc. -->
  hx-trigger="click"      <!-- click, keyup, change, load, etc. -->
  hx-indicator="#spinner">
'''
example = '''
<!-- Debounced search -->
<input type="text"
  hx-get="/api/search"
  hx-target="#results"
  hx-trigger="keyup changed delay:400ms"
  hx-indicator="#search-spinner">

<!-- Row click navigation -->
<tr hx-get="/contacts/{{ id }}"
    hx-target="body"
    hx-push-url="true">

<!-- Inline delete with confirmation -->
<button hx-delete="/api/tasks/{{ id }}"
        hx-target="closest tr"
        hx-swap="outerHTML"
        hx-confirm="Delete this task?">
'''
related = ["templates", "fragment_contract", "oob_swap"]
cognition_tips = [
    "All behavior is visible in HTML attributes - no hidden JavaScript",
    "Server is source of truth; client just displays rendered HTML",
    "Use hx-indicator for loading states, hx-confirm for destructive actions",
    "Combine with Alpine.js for UI-only state (dropdowns, modals)"
]
mcp_resource = "dazzle://docs/htmx-templates"

[concepts.templates]
category = "Frontend"
definition = "Three-layer Jinja2 template architecture: Components (full page content), Fragments (HTMX-swappable partials), Macros (pure rendering helpers). Each layer has distinct responsibilities."
syntax = '''
templates/
├── base.html                 # Document shell
├── components/               # Full page content (one per surface mode)
│   ├── list_view.html
│   ├── detail_view.html
│   └── form_edit.html
├── fragments/                # HTMX-swappable partials
│   ├── table_rows.html
│   ├── search_select.html
│   └── form_errors.html
└── macros/                   # Pure rendering helpers
    ├── form_field.html
    └── table_cell.html
'''
related = ["htmx", "fragment_contract", "surface"]
cognition_tips = [
    "Components: ~100-150 lines, one per surface mode",
    "Fragments: ~20-50 lines, single responsibility, HTMX-addressable",
    "Macros: ~10-30 lines, pure functions, no side effects",
    "An entire feature fits in ~300 lines (component + 2-3 fragments)"
]
layer_rules = [
    "Components define layout and include fragments",
    "Fragments are swapped by HTMX, communicate via events",
    "Macros are called by components/fragments, never by HTMX directly"
]
mcp_resource = "dazzle://docs/htmx-templates"

[concepts.fragment_contract]
category = "Frontend"
definition = "A fragment's formal interface specifying required/optional params, events it emits, events it listens to, and swap targets. Enables LLM agents to compose fragments without reading implementation."
syntax = '''
fragment: <name>
template: fragments/<name>.html

params:
  required: [field.name, field.label, endpoint]
  optional: [placeholder, debounce_ms]

emits: [itemSelected, formSaved]
listens: [searchCleared]

swap_targets: ["#{{ field.name }}-results"]
oob_targets: ["#field-{{ autofill_target }}"]
'''
example = '''
# Discovery before modification
mcp__dazzle__dsl(operation="list_fragments")

# Returns structured contracts:
{
  "search_select": {
    "params": ["field.name", "field.source.endpoint", ...],
    "emits": ["itemSelected"],
    "listens": [],
    "description": "Debounced search with autofill"
  }
}
'''
related = ["templates", "htmx"]
cognition_tips = [
    "Always check contracts before modifying fragments",
    "Contracts tell you WHAT without reading HOW",
    "Events are the communication mechanism between fragments",
    "Use list_fragments to discover available fragments"
]

[concepts.oob_swap]
category = "Frontend"
definition = "Out-of-band swap pattern (hx-swap-oob) for updating multiple DOM elements from a single server response. Used for autofill: selecting a search result populates multiple related form fields."
syntax = '''
<!-- Server response includes multiple elements -->

<!-- Primary swap (goes to hx-target) -->
<div id="search-selected">Selected: Acme Ltd</div>

<!-- OOB swaps (go to their own ids) -->
<input id="field-company_number" value="12345678"
       hx-swap-oob="outerHTML" readonly />
<input id="field-status" value="active"
       hx-swap-oob="outerHTML" readonly />
'''
example = '''
# Python endpoint returning OOB response
from dazzle_back.runtime.htmx import render_oob_fields

@router.get("/select/{id}")
async def select_company(id: str):
    company = await get_company(id)
    return render_oob_fields(
        primary=f"Selected: {company.name}",
        autofill={
            "company_number": company.number,
            "company_status": company.status,
        }
    )
'''
related = ["htmx", "fragment_contract", "search_select"]
cognition_tips = [
    "OOB is for updating MULTIPLE targets from ONE response",
    "Primary swap goes to hx-target; OOB goes to element's own id",
    "Use for autofill patterns: select item -> populate related fields",
    "Server renders OOB fields using same macro as original form"
]

[concepts.sitespec]
category = "Frontend"
definition = "Site configuration file (sitespec.yaml) defining brand, navigation, page structure, legal pages, auth pages, and integrations. Structural configuration for the marketing/public site shell, NOT content."
syntax = '''
# site/sitespec.yaml
version: "1.0"
brand:
  product_name: "FreshMeals"
  tagline: "Chef-quality meals delivered"
  support_email: "support@freshmeals.com"
layout:
  nav:
    public:
      - label: "Features"
        href: "/features"
  footer:
    columns:
      - title: "Product"
        links: [...]
pages:
  - route: "/"
    type: landing
    sections: []  # Content comes from copy.md
'''
example = '''
# Minimal sitespec.yaml
version: "1.0"
brand:
  product_name: "My SaaS"
  tagline: "Do more with less"
layout:
  nav:
    public:
      - label: "Home"
        href: "/"
pages:
  - route: "/"
    type: landing
'''
related = ["copy_md", "site_coherence"]
cognition_tips = [
    "sitespec.yaml = STRUCTURE (what pages exist, how nav works)",
    "copy.md = CONTENT (headlines, features, testimonials)",
    "At runtime, copy.md is merged INTO sitespec sections",
    "If copy.md exists, its sections REPLACE inline sitespec sections",
    "Use sitespec for: brand, nav, footer, page routes, legal, auth",
    "Use copy.md for: hero text, features, pricing, FAQ, testimonials"
]

[concepts.copy_md]
category = "Frontend"
definition = "Founder-friendly markdown file for PROSE marketing content. Best for: hero headlines, feature descriptions, testimonials, FAQ text. NOT for structured data like pricing tiers - those belong in sitespec.yaml."
syntax = '''
# site/content/copy.md

# Hero
**Your Headline Here**
Subheadline text explaining the value proposition.
[Get Started](/signup) | [Learn More](/features)

---

# Features
## Fast Performance
Description of the speed benefit. [icon: bolt]

## Easy to Use
Description of the UX benefit. [icon: sparkles]

---

# Testimonials
> "This transformed our workflow!"
> — Jane Smith, CEO at Acme Inc

---

# FAQ
## What is this product?
Clear answer explaining the product.

## How do I get started?
Step by step instructions.
'''
example = '''
# Hero
**Run your business, not your admin**
Automate repetitive tasks and focus on growth.
[Start Free Trial](/signup)

---

# Features
## Automated Workflows
Set up once, run forever. No coding required. [icon: bolt]

## Real-time Analytics
See what matters, when it matters. [icon: chart]
'''
related = ["sitespec", "site_coherence"]
cognition_tips = [
    "copy.md = PROSE content (headlines, descriptions, quotes)",
    "sitespec.yaml = STRUCTURED data (pricing tiers, navigation)",
    "IMPORTANT: Define pricing in sitespec.yaml, not copy.md",
    "Pricing in copy.md is best-effort parsing; may skip unparseable tiers",
    "Use --- separators between sections",
    "CTAs use markdown links: [Button Text](/path)",
    "Icons: add [icon: name] at end of description"
]
methodology = '''
## Clear Methodology for LLM Agents

### What goes WHERE:

**sitespec.yaml** (structure + structured data):
- Brand info (product_name, tagline, support_email)
- Navigation links
- Page routes and types
- Footer columns
- Legal pages (terms, privacy routes)
- Auth pages config
- **PRICING TIERS** (structured: name, price, period, features)

**copy.md** (prose content):
- Hero headlines and subheadlines
- Feature titles and descriptions
- Testimonial quotes
- FAQ questions and answers
- CTA headlines

### Why this split?
Pricing requires structured data (exact price, period, feature lists).
Markdown parsing is fragile - £49/month may not parse correctly.
Keep structured data in YAML where it's explicit and reliable.

### Workflow:
1. Define structure in sitespec.yaml (including pricing)
2. Write prose content in copy.md
3. At runtime, copy.md merges into landing page sections
4. Unparseable pricing sections are SKIPPED (not merged)
'''
