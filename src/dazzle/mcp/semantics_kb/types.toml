# Types Concepts
# Auto-generated from semantics.py

[meta]
file = "types"
concept_count = 6

[concepts.enum]
category = "Type System"
definition = "Enumeration type defining a fixed set of allowed values. Values are comma-separated inside square brackets with no spaces. Can specify a default value with =."
syntax = '''
<field_name>: enum[value1,value2,value3]
<field_name>: enum[value1,value2,value3]=default_value
'''
example = '''
entity Task "Task":
  id: uuid pk
  title: str(200) required

  # Basic enum with default
  priority: enum[low,normal,high,urgent]=normal

  # Status enum for state tracking
  task_status: enum[todo,in_progress,blocked,done]=todo

  # Type classification
  task_type: enum[bug,feature,chore,spike]=feature
'''
related = ["field_types", "reserved_keywords", "entity"]
important_notes = ["Values are case-sensitive", "Default value must be one of the listed values", "Spaces between values are optional (enum[a, b, c] and enum[a,b,c] both work)", "Most keywords can now be used as enum values (create, update, delete, etc.)"]

[concepts.enum.common_workarounds]
"create/update/delete" = "Use add/modify/remove or created/updated/deleted"
email = "Use mail or email_address"
status = "Use state or current_status (status is a keyword)"
manual = "Use manual_entry or by_hand"
submitted = "Use sent or filed"
message = "Use notification or alert"

[concepts.field_types]
category = "Type System"
definition = "Data types available for entity fields: str(N), text, int, decimal(P,S), bool, date, datetime, uuid, email, json, money, enum[...], ref Entity, has_many/has_one/embeds/belongs_to, timezone."
related = ["entity", "json", "money", "timezone"]
v0_2_changes = "No changes from v0.1"
v0_9_4_changes = "Added json type for flexible JSON data storage"
v0_20_changes = "Added money type for canonical monetary value representation"

[concepts.json]
category = "Type System"
definition = "Flexible JSON data type for storing structured but schema-less data. Maps to JSONB in PostgreSQL, JSON in MySQL/SQLite. Use for metadata, settings, external API payloads, or any data with variable structure."
syntax = "<field_name>: json"
example = '''
entity Contact "Contact":
  id: uuid pk
  name: str(200) required

  # Flexible metadata - structure can vary per record
  metadata: json

  # User preferences (UI settings, notifications, etc.)
  preferences: json

  # External system data (from integrations)
  external_data: json
'''
related = ["field_types", "entity", "embeds"]
v0_9_4_changes = "NEW in v0.9.4"
best_practices = ["Use for truly dynamic data where schema varies", "Prefer explicit fields when structure is known", "Consider embeds for structured nested data", "JSON fields have limited query/filter support", "Validate JSON structure in application code if needed"]
security_notes = ["JSON is deserialized safely by the runtime", "Avoid storing executable code in JSON fields", "Treat JSON field contents as untrusted user input"]

[concepts.ref]
category = "Type System"
definition = "Reference (foreign key) to another entity. Creates a relationship between entities. The referenced entity must be defined in the same module or imported."
syntax = "<field_name>: ref <EntityName> [required|optional]"
example = '''
entity Contact "Contact":
  id: uuid pk
  name: str(200) required

  # Optional reference (can be null)
  assigned_agent: ref User optional

  # Required reference (must have value)
  company: ref Company required

  # Self-reference (same entity)
  manager: ref Contact optional

  # Multiple references to same entity
  created_by: ref User required
  updated_by: ref User optional
'''
related = ["field_types", "relationships", "entity"]

[concepts.relationships]
category = "Type System"
definition = "References and ownership relationships between entities. v0.7.1 adds semantic relationship types (has_many, has_one, embeds, belongs_to) with delete behaviors."
syntax = '''
# Simple reference (foreign key)
field_name: ref <EntityName> [required|optional]

# v0.7.1 Ownership relationships
field_name: has_many <EntityName> [cascade|restrict|nullify|readonly]
field_name: has_one <EntityName> [cascade|restrict|nullify]
field_name: embeds <EntityName>
field_name: belongs_to <EntityName>
'''
example = '''
# Parent entity with children
entity Order "Order":
  id: uuid pk
  items: has_many OrderItem cascade  # Delete items when order deleted
  shipping_address: embeds Address   # Embedded value object
  customer: ref Customer required    # Foreign key reference

entity OrderItem "Order Item":
  id: uuid pk
  order: belongs_to Order            # Inverse of has_many
  product: ref Product required

# Readonly relationship (prevents modification through parent)
entity Customer "Customer":
  id: uuid pk
  orders: has_many Order readonly    # View orders but don't modify through Customer
'''
related = ["entity", "field_types", "archetype"]
v0_2_changes = "No changes from v0.1"
v0_7_1_changes = "Added has_many, has_one, embeds, belongs_to with cascade/restrict/nullify/readonly behaviors"

[concepts.relationships.relationship_types]
ref = "Simple foreign key reference to another entity"
has_many = "Parent owns multiple children (one-to-many)"
has_one = "Parent owns exactly one child (one-to-one)"
embeds = "Value object embedded in parent (no separate identity)"
belongs_to = "Child side of has_many/has_one relationship"

[concepts.money]
category = "Type System"
definition = "Canonical money representation for monetary values. Uses integer minor units (pence/cents) + ISO 4217 currency code for precision and JSON serialization safety. REQUIRED for monetary fields in FACT/INTENT streams."
syntax = '''
<field_name>: money [required|optional]
<field_name>: money(GBP) [required|optional]  # Explicit currency
'''
example = '''
entity Order "Order":
  id: uuid pk
  customer: ref Customer required

  # Money field - expands to amount_minor (int) + currency (str)
  total: money required

  # With explicit currency
  shipping_cost: money(GBP)

  # Optional money field
  discount: money optional

entity Invoice "Invoice":
  id: uuid pk
  order: ref Order required

  # Multiple money fields
  subtotal: money required
  tax_amount: money required
  total_amount: money required
'''
related = ["field_types", "entity", "decimal"]
v0_20_changes = "NEW in v0.20.0 - Canonical money representation"

[concepts.money.why_not_decimal]
json_safety = "Decimal is not JSON-serializable by default, causing serialization errors in event payloads"
precision = "Float has precision issues (0.1 + 0.2 != 0.3), int minor units are exact"
explicit_units = "field_minor makes units explicit (pence, cents) vs ambiguous amount"
industry_standard = "Stripe, Adyen, and most payment APIs use integer minor units"

[concepts.money.runtime_representation]
description = "Money expands to two fields in the database and event payloads"
amount_minor = "Integer amount in minor currency units (e.g., 1999 = 19.99 GBP)"
currency = "ISO 4217 currency code (e.g., 'GBP', 'USD', 'EUR')"
example_payload = '''
{
  "amount_minor": 1999,
  "currency": "GBP"
}
'''

[concepts.money.currency_scales]
description = "Different currencies have different decimal scales"
GBP = "2 decimal places (100 pence = 1 pound)"
USD = "2 decimal places (100 cents = 1 dollar)"
EUR = "2 decimal places (100 cents = 1 euro)"
JPY = "0 decimal places (no minor unit)"
BHD = "3 decimal places (1000 fils = 1 dinar)"

[concepts.money.lint_rule]
description = "Linter enforces Money type for monetary fields in FACT/INTENT streams"
error_for_decimal = "Using decimal for money in FACT streams is an error"
warning_for_entity_decimal = "Using decimal in entities without currency field is a warning"
pattern_detection = "Fields named amount, price, cost, total, etc. are checked"

[concepts.timezone]
category = "Type System"
definition = "IANA timezone identifier field type for storing timezone names like 'Europe/London', 'America/New_York', 'UTC'. Used for timezone configuration in settings entities."
syntax = "<field_name>: timezone [= \"default_timezone\"]"
example = '''
entity AppSettings "Application Settings":
    archetype: settings
    id: uuid pk

    # System timezone with default
    timezone: timezone = "UTC"

entity UserPreferences "User Preferences":
    id: uuid pk
    user: ref User required

    # User-specific timezone
    display_timezone: timezone = "Europe/London"

entity Company "Company":
    archetype: tenant
    id: uuid pk
    name: str(200) required

    # Per-tenant timezone
    timezone: timezone = "UTC"
'''
related = ["field_types", "settings_archetype", "tenant_archetype"]
v0_10_3_changes = "NEW in v0.10.3"
valid_values = ["IANA timezone identifiers (e.g., 'Europe/London', 'America/New_York', 'Asia/Tokyo')", "UTC", "Region/City format required for DST support"]
important_notes = ["Stored as string in database", "Validated against IANA timezone database at runtime", "Use for date/time display preferences", "Does not affect how dates are stored (always UTC in database)"]
