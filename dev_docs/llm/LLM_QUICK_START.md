# LLM-Assisted Spec Analysis - Quick Start Guide

## What is it?

DAZZLE now includes AI-powered specification analysis that helps you go from a natural language product spec to working code in minutes, not weeks.

**The Problem**: Writing formal DSL is hard. You have a clear vision of your app in your head, but expressing state machines, CRUD operations, and business rules in DSL syntax is tedious and error-prone.

**The Solution**: Write your spec in natural language (markdown), let AI extract the structure, answer a few clarifying questions, and get generated DSL ready to build.

## 5-Minute Tutorial

### Step 1: Write Your Spec

Create a `SPEC.md` file describing your app in plain English:

```markdown
# Task Manager

I need a simple task manager where users can:
- Create tasks with a title and description
- Set task status: To Do, In Progress, or Done
- Set priority: Low, Medium, or High
- View all tasks
- Edit and delete tasks

Each task should track when it was created and last updated.
```

That's it! No DSL syntax needed.

### Step 2: Set Up LLM Integration

```bash
# Install DAZZLE with LLM support
pip install "dazzle[llm]"

# Set your Anthropic API key (get one at https://console.anthropic.com/)
export ANTHROPIC_API_KEY=sk-ant-...
```

### Step 3: Analyze Your Spec

**Via CLI:**
```bash
dazzle analyze-spec SPEC.md
```

**Via VS Code:**
1. Open `SPEC.md` in VS Code
2. Press `Cmd+Shift+P` (Mac) or `Ctrl+Shift+P` (Windows/Linux)
3. Type "DAZZLE: Analyze Specification"
4. Press Enter

### Step 4: Review Analysis Results

The AI will extract:

```
============================================================
ðŸ“Š Specification Analysis Results
============================================================

ðŸ”„ State Machines: 1
   â€¢ Task.status: To Do, In Progress, Done
     - 3 transitions found

ðŸ“‹ Entities Analyzed: 1
   âœ“ Task: All CRUD operations found

ðŸ“ Business Rules: 3
   â€¢ validation: 2
   â€¢ constraint: 1

ðŸ“ˆ Coverage:
   â€¢ State Machines: 100.0%
   â€¢ CRUD Operations: 100.0%
```

### Step 5: Answer Clarifying Questions (Optional)

If there are gaps, the AI asks questions:

```
â“ Clarifying Questions: 3

1. Who can change task status to "Done"?
   Context: State transition not explicit in spec
   Impacts: Access control logic

   Options:
     1) Anyone
     2) Task creator only
     3) Admin only

   Choose (1-3): 1
   âœ“ Selected: Anyone
```

### Step 6: Generate DSL

```bash
dazzle analyze-spec SPEC.md --generate-dsl
```

This creates `dsl/generated.dsl`:

```dsl
# Generated by DAZZLE LLM-assisted spec analysis

module task_manager

app task_manager "Task Manager"

# ============================================================================
# ENTITIES
# ============================================================================

entity Task "Task":
  id: uuid pk
  title: str(200) required
  description: text
  status: enum[todo,in_progress,done]=todo
  priority: enum[low,medium,high]=medium
  created_at: datetime auto_add
  updated_at: datetime auto_update

# ============================================================================
# SURFACES
# ============================================================================

surface task_list "Task List":
  uses entity Task
  mode: list

  section main "Tasks":
    field title "Title"
    field status "Status"
    field priority "Priority"
    field created_at "Created"

surface task_detail "Task Detail":
  uses entity Task
  mode: view

  section main "Task Details":
    field title "Title"
    field description "Description"
    field status "Status"
    field priority "Priority"
    field created_at "Created"
    field updated_at "Last Updated"

surface task_create "New Task":
  uses entity Task
  mode: create

  section main "Create Task":
    field title "Title"
    field description "Description"
    field priority "Priority"

surface task_edit "Edit Task":
  uses entity Task
  mode: edit

  section main "Edit Task":
    field title "Title"
    field description "Description"
    field status "Status"
    field priority "Priority"
```

### Step 7: Build Your App

```bash
# Validate the generated DSL
dazzle validate

# Build Django backend
dazzle build

# Run your app
cd build/task_manager
python manage.py migrate
python manage.py runserver
```

**That's it!** From idea to working app in 5 minutes.

---

## Real-World Example

Let's analyze the `support_tickets` example spec:

```bash
cd examples/support_tickets
dazzle analyze-spec SPEC.md
```

**Output:**
```
ðŸ”„ State Machines: 1
   â€¢ Ticket.status: open, in_progress, resolved, closed
     - 7 transitions found
     - âš  3 transitions missing

ðŸ“‹ Entities Analyzed: 3
   â€¢ Ticket: All CRUD operations found
   â€¢ User: Missing "update" operation
   â€¢ Comment: Missing "list" operation

â“ Clarifying Questions: 12
   â€¢ State Machine (high): 3 questions
   â€¢ CRUD Completeness (medium): 4 questions
   â€¢ Access Control (high): 5 questions
```

The AI found:
- âœ… A state machine for ticket lifecycle
- âš ï¸ 3 missing state transitions (e.g., can tickets be reopened?)
- âš ï¸ Missing operations (can users edit their profiles? how to list comments?)
- â“ 12 clarifying questions to complete the spec

After answering the questions, you get **complete, validated DSL** ready to build.

---

## What Gets Extracted?

### 1. State Machines
- **States**: All status values mentioned (open, closed, pending, etc.)
- **Transitions**: Who can move between states and when
- **Missing transitions**: Gaps the AI identifies (e.g., can closed tickets be reopened?)
- **Business logic**: Side effects when states change (send email, create notification)

### 2. CRUD Operations
- **Create**: Forms and required fields
- **Read**: Detail views and what fields to show
- **Update**: Edit forms and who can edit
- **Delete**: Cascade rules and permissions
- **List**: Filters, search, sorting

### 3. Business Rules
- **Validation**: Required fields, unique constraints, formats
- **Access control**: Who can do what
- **Cascades**: What happens when you delete something
- **Computed fields**: Derived values

### 4. Clarifying Questions
- **High priority**: Gaps that block code generation
- **Medium priority**: Missing features that affect UX
- **Low priority**: Optional enhancements

---

## Cost

### API Pricing (Anthropic Claude Sonnet)
- **Small spec** (5KB): ~$0.08 per analysis
- **Medium spec** (15KB): ~$0.15 per analysis
- **Large spec** (50KB): ~$0.30 per analysis

### Break-Even
If you analyze >4 specs per day, consider [Claude Pro](https://claude.ai/pro) ($20/month unlimited) instead of API access.

---

## Tips for Great Results

### 1. Write Clear Specs
**Good:**
```markdown
Users can create tickets. Each ticket has:
- Title (required, max 200 characters)
- Description (optional, rich text)
- Status: open â†’ in_progress â†’ resolved â†’ closed
- Priority: low, medium, high (default: medium)
```

**Better:**
```markdown
## Ticket Lifecycle

Users create tickets in "open" status. Support staff can move tickets:
- open â†’ in_progress (when they start working)
- in_progress â†’ resolved (when fixed)
- resolved â†’ closed (after user confirms)
- Any status â†’ closed (to mark as spam/duplicate)

Only admins can reopen closed tickets.
```

The more explicit you are about workflows and permissions, the better the analysis.

### 2. Use Examples
```markdown
Example ticket:
- Title: "Login button not working"
- Description: "When I click login, nothing happens..."
- Status: open
- Created by: user@example.com
- Assigned to: support@example.com
```

Examples help the AI understand your data model.

### 3. Mention Edge Cases
```markdown
- Can users delete their own tickets? No, only admins.
- Can closed tickets be reopened? Yes, by admins only.
- What happens when a user is deleted? Their tickets are reassigned to "unassigned".
```

Edge cases become clarifying questions if not mentioned.

### 4. Describe UI Needs
```markdown
## UI Requirements

Ticket list page should show:
- Title
- Status (with color coding: green=resolved, red=open)
- Priority (as stars: â­â­â­ for high)
- Created date (relative: "2 hours ago")
- Filter by status, priority, assigned user
- Search by title/description
```

UI details help generate appropriate surfaces.

---

## Troubleshooting

### "API key not found"
```bash
# Check if key is set
echo $ANTHROPIC_API_KEY

# Set it
export ANTHROPIC_API_KEY=sk-ant-...

# Make it permanent (add to ~/.bashrc or ~/.zshrc)
echo 'export ANTHROPIC_API_KEY=sk-ant-...' >> ~/.zshrc
```

### "LLM dependencies not installed"
```bash
pip install anthropic openai
# Or
pip install "dazzle[llm]"
```

### Analysis seems incomplete
- Make your spec more detailed
- Use examples to clarify
- Mention edge cases explicitly
- Answer all high-priority questions

### Generated DSL has errors
1. Review the generated DSL
2. Customize field types, constraints
3. Add relationships between entities
4. Run `dazzle validate` to check
5. Fix any validation errors

The generated DSL is a starting point - you can (and should) customize it.

---

## Advanced Usage

### Use OpenAI Instead of Anthropic
```bash
export OPENAI_API_KEY=sk-...
dazzle analyze-spec SPEC.md --provider openai --model gpt-4-turbo
```

### JSON Output (for tooling)
```bash
dazzle analyze-spec SPEC.md --output-json > analysis.json
```

### Skip Q&A (auto-generate)
```bash
dazzle analyze-spec SPEC.md --no-interactive --generate-dsl
```

### Custom Model
```bash
dazzle analyze-spec SPEC.md --model claude-3-opus-20240229
```

---

## Next Steps

1. **Try it**: Analyze the example specs in `examples/`
2. **Write your own**: Create a `SPEC.md` for your project
3. **Iterate**: Answer questions, regenerate, refine
4. **Build**: Run `dazzle build` to generate code
5. **Ship**: Deploy to production

**Happy building!** ðŸš€

---

## Feedback

Found a bug? Have a suggestion?

- [GitHub Issues](https://github.com/yourusername/dazzle/issues)
- [Documentation](https://github.com/yourusername/dazzle/docs)
- [Examples](https://github.com/yourusername/dazzle/examples)
